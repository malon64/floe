version: "0.1"

metadata:
  project: "floe"
  description: "Example multi-entity technical ingestion config"
  owner: "data-platform"
  tags: ["v0.1", "examples"]

entities:
  - name: "customer"

    metadata:
      data_product: "customer_master"
      domain: "sales"
      owner: "data-platform"
      description: "Technical ingestion contract for customer dataset"
      tags: ["prepared", "masterdata"]

    source:
      format: "csv"
      path: "/home/alexis/floe/example/in/customer/customers_missing.csv"
      options:
        header: true
        separator: ","
        encoding: "utf-8"
        null_values: ["", "NULL", "null"]
      cast_mode: "coerce"   # strict | coerce

    sink:
      accepted:
        format: "parquet"
        path: "/home/alexis/floe/example/out/accepted/customer/"
      rejected:
        format: "csv"
        path: "/home/alexis/floe/example/out/rejected/customer/"
      report:
        path: "/home/alexis/floe/example/out/reports/customer/"

    policy:
      severity: "reject"   # warn | reject | abort

      quarantine:
        mode: "row"                # row | file
        add_reason_columns: true
        reason_columns:
          rule: "__floe_rule"
          column: "__floe_column"
          message: "__floe_message"

      thresholds:
        max_reject_rate: 0.05
        max_reject_count: 100000

    schema:
      normalize_columns:
        enabled: true
        strategy: "snake_case"     # snake_case | lower | none

      columns:
        - name: "customer_id"
          type: "string"
          nullable: false
          unique: true
          unique_strategy: "reject_all"  # reject_all | keep_first | keep_last

        - name: "email"
          type: "string"
          nullable: true
          unique: false

        - name: "country_code"
          type: "string"
          nullable: true
          unique: false

        - name: "created_at"
          type: "datetime"
          nullable: true
          unique: false
