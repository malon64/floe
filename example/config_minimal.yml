version: "0.1"

env:
  vars:
    report_root: "./report"
    out_root: "./out"
    incoming_root: "./in"

domains:
  - name: "sales"
    incoming_dir: "{{incoming_root}}/customer"

report:
  path: "{{report_root}}"

entities:
  - name: "customer"
    domain: "sales"
    source:
      format: "csv"
      path: "{{domain.incoming_dir}}"
      options:
        header: true
        separator: ","
        null_values: ["", "NULL", "null"]
      cast_mode: "coerce"

    sink:
      accepted:
        format: "parquet"
        path: "{{out_root}}/accepted/customer/"
      rejected:
        format: "csv"
        path: "{{out_root}}/rejected/customer/"
      archive:
        path: "{{out_root}}/accepted/customer/archived"

    policy:
      severity: "reject"
    schema:
      columns:
        - name: "customer_id"
          type: "string"
          nullable: false
          unique: true
        - name: "created_at"
          type: "datetime"
          nullable: true
          unique: false
