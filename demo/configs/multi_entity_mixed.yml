version: "0.1"

report:
  path: "../report"

entities:
  - name: "customer"

    source:
      format: "csv"
      path: "../in/customer"
      options:
        header: true
        separator: ","
        null_values: ["", "NULL", "null"]
      cast_mode: "strict"

    sink:
      accepted:
        format: "parquet"
        path: "../out/accepted/customer"
      rejected:
        format: "csv"
        path: "../out/rejected/customer"

    policy:
      severity: "reject"

    schema:
      mismatch:
        missing_columns: "fill_nulls"
        extra_columns: "ignore"
      normalize_columns:
        enabled: true
        strategy: "snake_case"
      columns:
        - name: "customer_id"
          type: "string"
          nullable: false
          unique: true

        - name: "email"
          type: "string"
          nullable: true
          unique: true

        - name: "country_code"
          type: "string"
          nullable: true
          unique: false

        - name: "created_at"
          type: "datetime"
          nullable: true
          unique: false

  - name: "orders"

    source:
      format: "parquet"
      path: "../in/orders"
      cast_mode: "strict"

    sink:
      accepted:
        format: "parquet"
        path: "../out/accepted/orders"
      rejected:
        format: "csv"
        path: "../out/rejected/orders"

    policy:
      severity: "reject"

    schema:
      mismatch:
        missing_columns: "fill_nulls"
        extra_columns: "ignore"
      normalize_columns:
        enabled: true
        strategy: "snake_case"
      columns:
        - name: "order_id"
          type: "string"
          nullable: false
          unique: true

        - name: "customer_id"
          type: "string"
          nullable: false
          unique: false

        - name: "order_total"
          type: "number"
          nullable: false
          unique: false

        - name: "currency"
          type: "string"
          nullable: true
          unique: false

        - name: "created_at"
          type: "datetime"
          nullable: true
          unique: false

        - name: "order_date"
          type: "date"
          nullable: true
          unique: false

        - name: "is_expedited"
          type: "boolean"
          nullable: true
          unique: false

  - name: "events"

    source:
      format: "json"
      path: "../in/events"
      options:
        ndjson: true
      cast_mode: "strict"

    sink:
      accepted:
        format: "parquet"
        path: "../out/accepted/events"
      rejected:
        format: "csv"
        path: "../out/rejected/events"

    policy:
      severity: "reject"

    schema:
      mismatch:
        missing_columns: "reject_file"
        extra_columns: "ignore"
      normalize_columns:
        enabled: true
        strategy: "snake_case"
      columns:
        - name: "event_id"
          type: "string"
          nullable: false
          unique: true

        - name: "customer_id"
          type: "string"
          nullable: false
          unique: false

        - name: "event_type"
          type: "string"
          nullable: false
          unique: false

        - name: "occurred_at"
          type: "datetime"
          nullable: false
          unique: false

        - name: "amount"
          type: "number"
          nullable: true
          unique: false

        - name: "is_test"
          type: "boolean"
          nullable: true
          unique: false
