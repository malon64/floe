version: "0.1"

metadata:
  project: "floe"
  description: "Example multi-entity technical ingestion config"
  owner: "data-platform"
  tags: ["v0.1", "examples"]

entities:
  - name: "customer"

    metadata:
      data_product: "customer_master"
      domain: "sales"
      owner: "data-platform"
      description: "Technical ingestion contract for customer dataset"
      tags: ["prepared", "masterdata"]

    source:
      format: "csv"
      path: "/home/alexis/floe/example/in/customer"
      options:
        header: true
        separator: ","
        encoding: "utf-8"
        null_values: ["", "NULL", "null"]
      cast_mode: "strict"   # strict | coerce

    sink:
      accepted:
        format: "parquet"
        path: "/home/alexis/floe/example/out/accepted/customer/"
      rejected:
        format: "csv"
        path: "/home/alexis/floe/example/out/rejected/customer/"
      report:
        path: "/home/alexis/floe/example/out/reports/customer/"
      archive:
        path: "/home/alexis/floe/example/in/customer"

    policy:
      severity: "abort"   # warn | reject | abort

      thresholds:
        max_reject_rate: 0.05
        max_reject_count: 100000

    schema:
      normalize_columns:
        enabled: true
        strategy: "snake_case"     # snake_case | lower | none

      columns:
        - name: "customer_id"
          type: "string"
          nullable: false
          unique: true

        - name: "email"
          type: "string"
          nullable: true
          unique: false

        - name: "country_code"
          type: "string"
          nullable: true
          unique: false

        - name: "created_at"
          type: "datetime"
          nullable: true
          unique: false
