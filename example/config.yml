version: "0.1"

metadata:
  project: "floe"
  description: "Example multi-entity technical ingestion config"
  owner: "data-platform"
  tags: ["v0.1", "examples"]

report:
  path: "./report"

entities:
  - name: "customer"

    metadata:
      data_product: "customer_master"
      domain: "sales"
      owner: "data-platform"
      description: "Technical ingestion contract for customer dataset"
      tags: ["prepared", "masterdata"]

    source:
      format: "csv"
      path: "./in/customer"
      options:
        header: true
        separator: ","
        encoding: "utf-8"
        null_values: ["", "NULL", "null"]
      cast_mode: "strict"   # strict | coerce

    sink:
      accepted:
        format: "delta"
        path: "./out/accepted/customer_delta/"
      rejected:
        format: "csv"
        path: "./out/rejected/customer/"


    policy:
      severity: "reject"   # warn | reject | abort

    schema:
      mismatch:
        missing_columns: "reject_file"
        extra_columns: "ignore"
      normalize_columns:
        enabled: true
        strategy: "snake_case"     # snake_case | lower | none

      columns:
        - name: "customer_id"
          type: "string"
          nullable: false
          unique: true

        - name: "email"
          type: "string"
          nullable: true
          unique: true

        - name: "country_code"
          type: "string"
          nullable: true
          unique: false

        - name: "created_at"
          type: "datetime"
          nullable: true
          unique: false

  - name: "orders"

    metadata:
      data_product: "order_events"
      domain: "sales"
      owner: "data-platform"
      description: "Technical ingestion contract for order events"
      tags: ["prepared", "events"]

    source:
      format: "json"
      path: "./in/orders"
      options:
        json_mode: "array"
      cast_mode: "strict"   # strict | coerce

    sink:
      accepted:
        format: "parquet"
        path: "./out/accepted/orders/"
        options:
          max_size_per_file: 1
      rejected:
        format: "csv"
        path: "./out/rejected/orders/"

    policy:
      severity: "warn"   # warn | reject | abort

    schema:
      mismatch:
        missing_columns: "fill_nulls"
        extra_columns: "reject_file"
      normalize_columns:
        enabled: true
        strategy: "snake_case"     # snake_case | lower | none

      columns:
        - name: "order_id"
          type: "string"
          nullable: false
          unique: true

        - name: "customer_id"
          type: "string"
          nullable: false
          unique: false

        - name: "order_total"
          type: "number"
          nullable: false
          unique: false

        - name: "currency"
          type: "string"
          nullable: true
          unique: false

        - name: "created_at"
          type: "datetime"
          nullable: true
          unique: false

        - name: "order_date"
          type: "date"
          nullable: true
          unique: false

        - name: "is_expedited"
          type: "boolean"
          nullable: true
          unique: false
